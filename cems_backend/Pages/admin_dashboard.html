<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard - CEMS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .sidebar {
            height: 100vh;
            background: #343a40;
            color: white;
            min-height: 100vh;
        }

        .sidebar a {
            color: #cfd2d6;
            text-decoration: none;
            display: block;
            padding: 10px 20px;
        }

        .sidebar a:hover,
        .sidebar a.active {
            background: #495057;
            color: white;
        }
    </style>
</head>

<body>

    <div class="d-flex">
        <div class="sidebar p-3" style="width: 250px;">
            <h4 class="mb-4 text-center">Admin Panel</h4>
            <a href="admin_dashboard.html" class="active">Dashboard</a>
            <a href="admin_users.html">Manage Users</a>
            <a href="admin_resources.html">Manage Clubs & Venues</a>
            <a href="index.html" class="mt-5 text-warning">‚Üê Back to Website</a>
            <button onclick="logout()" class="btn btn-danger w-100 mt-2">Logout</button>
        </div>

        <div class="p-4 w-100 bg-light">
            <h2 class="mb-4">System Overview</h2>

            <div class="row g-4 text-center">
                <div class="col-md-3">
                    <div class="card p-4 border-0 shadow-sm text-primary">
                        <h1 id="countUsers">0</h1>
                        <span>Total Users</span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card p-4 border-0 shadow-sm text-success">
                        <h1 id="countEvents">0</h1>
                        <span>Total Events</span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card p-4 border-0 shadow-sm text-warning">
                        <h1 id="countClubs">0</h1>
                        <span>Active Clubs</span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card p-4 border-0 shadow-sm text-info">
                        <h1 id="countVenues">0</h1>
                        <span>Venues</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = "http://127.0.0.1:8000";
        const token = localStorage.getItem("token");
        const role = localStorage.getItem("role");

        // Security Check
        if (!token || role !== 'admin') {
            alert("Access Denied. Admins only.");
            window.location.href = "login.html";
        }

        // Fetch Stats
        async function loadStats() {
            const res = await fetch(`${API_URL}/admin/stats`, {
                headers: { "Authorization": `Bearer ${token}` }
            });
            if (res.ok) {
                const data = await res.json();
                document.getElementById("countUsers").innerText = data.total_users;
                document.getElementById("countEvents").innerText = data.total_events;
                document.getElementById("countClubs").innerText = data.total_clubs;
                document.getElementById("countVenues").innerText = data.total_venues;
            }
        }

        function logout() {
            localStorage.clear();
            window.location.href = "login.html";
        }

        loadStats();
    </script>
</body>

</html>